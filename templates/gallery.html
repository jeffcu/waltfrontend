<script>
    function openTestWindow() {
        let newWindow = window.open("", "TestWindow", "width=500,height=500");

        if (newWindow) {
            newWindow.document.write(`
                <html>
                <head>
                    <title>API Test</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            text-align: center;
                            margin-top: 20px;
                        }
                        input {
                            width: 80%;
                            padding: 8px;
                            margin-bottom: 10px;
                            font-size: 16px;
                        }
                        button {
                            padding: 10px 15px;
                            font-size: 16px;
                            cursor: pointer;
                            background-color: #94d2bd;
                            color: #1b4332;
                            border: none;
                            border-radius: 5px;
                        }
                        button:hover {
                            background-color: #65a39f;
                        }
                        #output {
                            width: 90%;
                            height: 250px;
                            margin-top: 10px;
                            border: 1px solid #ccc;
                            overflow-y: auto;
                            background: #f8f8f8;
                            text-align: left;
                            padding: 5px;
                            font-size: 14px;
                            white-space: pre-wrap;
                        }
                    </style>
                    <script>
                        function callOpenAI() {
                            let inputText = document.getElementById("query").value;
                            let outputBox = document.getElementById("output");

                            fetch("/api_test", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ query: inputText })
                            })
                            .then(response => response.json())
                            .then(data => {
                                outputBox.innerHTML += "\\n> " + inputText + "\\n" + data.response + "\\n";
                                outputBox.scrollTop = outputBox.scrollHeight;
                            })
                            .catch(error => {
                                outputBox.innerHTML += "\\nError: " + error.message + "\\n";
                            });
                        }
                    <\/script>
                </head>
                <body>
                    <h2>API Test</h2>
                    <input type="text" id="query" value="Who invented velcro?">
                    <button onclick="callOpenAI()">Run API</button>
                    <div id="output"></div>
                    <br>
                    <button onclick="window.close()">Close</button>
                </body>
                </html>
            `);
            newWindow.document.close();
        } else {
            alert("Popup blocked! Please allow popups for this site.");
        }
    }
</script>
